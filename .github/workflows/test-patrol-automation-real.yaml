name: Patrol Setup on Ubuntu Latest

on:
  workflow_dispatch:

jobs:
  patrol-test:
    runs-on: ubuntu-latest

    steps:
      # # 1. à¸”à¸¶à¸‡ Source Code à¸‚à¸­à¸‡à¹‚à¸›à¸£à¹€à¸ˆà¸à¸•à¹Œà¸„à¸¸à¸“
      # - name: Checkout Code
      #   uses: actions/checkout@v4

      # 2. à¸•à¸´à¸”à¸•à¸±à¹‰à¸‡ Java (à¸ˆà¸³à¹€à¸›à¹‡à¸™à¸ªà¸³à¸«à¸£à¸±à¸š Android SDK à¹à¸¥à¸° Gradle)
      - name: Setup Java
        uses: actions/setup-java@v4
        with:
          distribution: "zulu"
          java-version: "17" # à¹à¸™à¸°à¸™à¸³à¹€à¸§à¸­à¸£à¹Œà¸Šà¸±à¸™ 17 à¸ªà¸³à¸«à¸£à¸±à¸š Android Build à¸›à¸±à¸ˆà¸ˆà¸¸à¸šà¸±à¸™

      # 3. à¸•à¸´à¸”à¸•à¸±à¹‰à¸‡ Flutter à¹à¸¥à¸° Dart à¸žà¸·à¹‰à¸™à¸à¸²à¸™à¹€à¸‚à¹‰à¸²à¹„à¸›à¹ƒà¸™ Runner
      - name: Setup Flutter and Dart
        uses: subosito/flutter-action@v2
        with:
          channel: "stable"
          cache: true

      # 4. à¸•à¸´à¸”à¸•à¸±à¹‰à¸‡ FVM (à¹€à¸™à¸·à¹ˆà¸­à¸‡à¸ˆà¸²à¸à¸„à¸¸à¸“à¹ƒà¸Šà¹‰ fvm flutter doctor à¹ƒà¸™ script)
      - name: Install FVM
        run: dart pub global activate fvm

      # 5. à¸•à¸´à¸”à¸•à¸±à¹‰à¸‡ Flutter SDK à¸•à¸²à¸¡à¹€à¸§à¸­à¸£à¹Œà¸Šà¸±à¸™à¹ƒà¸™à¹„à¸Ÿà¸¥à¹Œ .fvm/fvm_config.json
      - name: Install Flutter SDK via FVM
        run: fvm install

      # 6. à¸•à¸´à¸”à¸•à¸±à¹‰à¸‡ Patrol CLI à¹à¸¥à¸°à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸² PATH
      - name: Setup Patrol CLI
        run: |
          dart pub global activate patrol_cli
          # à¹€à¸žà¸´à¹ˆà¸¡ PATH à¹€à¸žà¸·à¹ˆà¸­à¹ƒà¸«à¹‰à¸ªà¸²à¸¡à¸²à¸£à¸–à¹€à¸£à¸µà¸¢à¸à¹ƒà¸Šà¹‰à¸„à¸³à¸ªà¸±à¹ˆà¸‡ 'patrol' à¹„à¸”à¹‰à¹‚à¸”à¸¢à¸•à¸£à¸‡
          echo "$HOME/.pub-cache/bin" >> $GITHUB_PATH

      # 7. à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸² Android SDK à¸•à¸²à¸¡ Script à¹€à¸”à¸´à¸¡à¸‚à¸­à¸‡à¸„à¸¸à¸“
      - name: Setup Android SDK
        run: |
          echo "ðŸ¤– Accepting Licenses and Installing Android SDK Components..."
          echo "y" | $ANDROID_HOME/cmdline-tools/latest/bin/sdkmanager --licenses
          $ANDROID_HOME/cmdline-tools/latest/bin/sdkmanager "platforms;android-36" "build-tools;36.1.0" "platform-tools"

      # 8. à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸„à¸§à¸²à¸¡à¸žà¸£à¹‰à¸­à¸¡à¸‚à¸­à¸‡à¸£à¸°à¸šà¸š
      - name: Check Patrol Doctor and Flutter Doctor
        run: |
          echo "ðŸš€ Final Check with Patrol Doctor..."
          patrol doctor
          echo "ðŸš€ Final Check with Flutter Doctor..."
          fvm flutter doctor -v
